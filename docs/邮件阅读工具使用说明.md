# 邮件阅读工具使用说明

## 工具概述

`read_emails` 是一个MCP工具，可以根据日期范围读取邮件内容，支持多种日期筛选方式，并提供邮件的基本信息、附件信息和正文内容。

## 工具参数

### 必需参数
- `imap_server` (string): IMAP服务器地址
- `username` (string): 邮箱用户名
- `password` (string): 邮箱密码或授权码

### 日期筛选参数（三选一）
- `days_ago` (integer): 读取多少天前的邮件，默认为7天
- `date` (string): 指定单日，格式 YYYY-MM-DD，可与 days_ago 互斥
- `start_date` (string): 起始日期，格式 YYYY-MM-DD
- `end_date` (string): 结束日期，格式 YYYY-MM-DD（含当日）

### 可选参数
- `max_emails` (integer): 最大读取邮件数量，默认为50封
- `include_body` (boolean): 是否包含邮件正文，默认为true
- `folder` (string): 邮箱文件夹，默认为INBOX

## 使用示例

### 示例1：读取最近3天的邮件
```json
{
  "tool": "read_emails",
  "parameters": {
    "imap_server": "imap.qq.com",
    "username": "your_email@qq.com",
    "password": "your_password",
    "days_ago": 3,
    "max_emails": 10,
    "include_body": true
  }
}
```

### 示例2：读取指定日期的邮件
```json
{
  "tool": "read_emails",
  "parameters": {
    "imap_server": "imap.qq.com",
    "username": "your_email@qq.com",
    "password": "your_password",
    "date": "2024-09-01",
    "max_emails": 20
  }
}
```

### 示例3：读取日期范围内的邮件
```json
{
  "tool": "read_emails",
  "parameters": {
    "imap_server": "imap.qq.com",
    "username": "your_email@qq.com",
    "password": "your_password",
    "start_date": "2024-09-01",
    "end_date": "2024-09-03",
    "max_emails": 30,
    "include_body": false
  }
}
```

### 示例4：读取特定文件夹的邮件
```json
{
  "tool": "read_emails",
  "parameters": {
    "imap_server": "imap.qq.com",
    "username": "your_email@qq.com",
    "password": "your_password",
    "days_ago": 7,
    "folder": "Sent",
    "max_emails": 15
  }
}
```

## 输出格式

工具执行成功后会返回格式化的邮件信息：

```
📧 邮件阅读结果 (最近3天)

共找到 15 封邮件，成功读取 10 封

=== 邮件 1 ===
📧 主题: 项目进度报告
👤 发件人: 张三 <zhangsan@company.com>
📅 日期: Mon, 02 Sep 2024 10:30:00 +0800
📎 附件: 是
📁 附件列表: 项目报告.pdf, 数据统计.xlsx
📝 正文预览: 各位同事，本周项目进展顺利，已完成主要功能开发...

=== 邮件 2 ===
📧 主题: 会议通知
👤 发件人: 李四 <lisi@company.com>
📅 日期: Mon, 02 Sep 2024 14:20:00 +0800
📎 附件: 否
📝 正文预览: 明天下午2点会议室A召开项目评审会议，请准时参加...
```

## 功能特点

### 1. 灵活的日期筛选
- **最近N天**: 使用 `days_ago` 参数
- **指定日期**: 使用 `date` 参数
- **日期范围**: 使用 `start_date` 和 `end_date` 参数

### 2. 智能邮件解析
- 自动解码邮件头信息（主题、发件人、收件人）
- 支持多种字符编码（UTF-8、GBK等）
- 智能识别HTML和纯文本邮件

### 3. 附件检测
- 自动检测邮件是否包含附件
- 列出所有附件文件名
- 支持各种文件类型

### 4. 正文处理
- 支持HTML邮件转换为纯文本
- 自动清理HTML标签
- 可控制是否包含正文内容

### 5. 性能优化
- 限制读取邮件数量，避免超时
- 正文预览限制长度，避免输出过长
- 自动处理连接和断开

## 支持的邮箱服务商

- **QQ邮箱**: imap.qq.com
- **163邮箱**: imap.163.com
- **Gmail**: imap.gmail.com
- **Outlook**: outlook.office365.com
- **其他IMAP服务商**

## 注意事项

1. **认证信息**: 确保使用正确的邮箱用户名和密码（或授权码）
2. **IMAP设置**: 确保邮箱已开启IMAP服务
3. **网络连接**: 确保网络连接正常，能够访问IMAP服务器
4. **邮件数量**: 建议设置合理的 `max_emails` 值，避免读取过多邮件导致超时
5. **正文长度**: 当 `include_body` 为true时，正文会被截断为200字符预览

## 错误处理

- 连接失败：检查IMAP服务器地址和认证信息
- 无邮件：检查日期范围和邮箱文件夹
- 读取失败：检查网络连接和邮件格式
- 超时：减少 `max_emails` 数量

## 与下载工具的区别

| 功能 | 下载工具 | 阅读工具 |
|------|----------|----------|
| 主要用途 | 下载邮件附件 | 阅读邮件内容 |
| 输出内容 | 附件文件 | 邮件信息文本 |
| 性能要求 | 较低 | 较高 |
| 使用场景 | 批量下载 | 邮件查看 |

这个邮件阅读工具非常适合需要快速查看邮件内容、筛选重要邮件或进行邮件内容分析的场景。

