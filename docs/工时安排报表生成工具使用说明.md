# 工时安排报表生成工具使用说明

## 工具概述

`generate_worktime_report` 是一个集成的MCP工具，它将Excel文件合并和工时数据处理功能整合在一起，可以一次性完成以下操作：

1. **合并多个Excel文件** - 将多个项目任务格式的Excel文件合并为一个
2. **生成工时展示图片** - 基于合并后的数据生成可视化的工时报表图片

## 工具参数

### 必需参数
- `output_image_path` (string): 输出工时展示图片文件路径

### 输入源参数（二选一）
- `input_files` (array): 要合并的项目任务格式Excel文件路径列表
- `input_dir` (string): 包含项目任务格式Excel文件的目录路径

### 可选参数
- `merged_excel_path` (string): 合并后的Excel文件保存路径（可选，不指定则使用临时文件）
- `staff_file_path` (string): 人员名单Excel文件路径（可选）
- `sheet_name` (string): 要读取的工作表名称，默认为"下周工作计划"
- `use_default_sheet` (boolean): 当指定的工作表不存在时，是否使用第一个工作表，默认为false
- `title` (string): 图表标题（可选）
- `keep_merged_file` (boolean): 是否保留合并后的Excel文件，默认为false

## 使用示例

### 示例1：合并指定文件并生成报表
```json
{
  "tool": "generate_worktime_report",
  "parameters": {
    "input_files": [
      "/path/to/file1.xlsx",
      "/path/to/file2.xlsx",
      "/path/to/file3.xlsx"
    ],
    "output_image_path": "/path/to/output/worktime_report.png",
    "title": "2024年第1周工时安排报表",
    "keep_merged_file": true,
    "merged_excel_path": "/path/to/output/merged_worktime.xlsx"
  }
}
```

### 示例2：合并目录中的所有文件
```json
{
  "tool": "generate_worktime_report",
  "parameters": {
    "input_dir": "/path/to/excel/files/",
    "output_image_path": "/path/to/output/worktime_report.png",
    "sheet_name": "下周工作计划",
    "staff_file_path": "/path/to/staff_list.xlsx"
  }
}
```

### 示例3：使用临时文件（推荐）
```json
{
  "tool": "generate_worktime_report",
  "parameters": {
    "input_dir": "/path/to/excel/files/",
    "output_image_path": "/path/to/output/worktime_report.png",
    "title": "项目工时统计报表"
  }
}
```

## 工作流程

1. **文件验证** - 检查所有输入文件是否存在
2. **Excel合并** - 将多个Excel文件合并为一个
3. **工时处理** - 基于合并后的数据生成工时展示图片
4. **文件清理** - 根据`keep_merged_file`参数决定是否保留合并文件

## 输出结果

工具执行成功后会返回包含以下信息的文本：

```
工时安排报表生成完成！

📊 合并了 3 个Excel文件，共 45 行数据
📈 工时展示图片已保存到: /path/to/output/worktime_report.png
📁 合并后的Excel文件已保存到: /path/to/output/merged_worktime.xlsx
🗑️ 临时合并文件已清理
```

## 注意事项

1. **文件格式**：输入文件必须是项目任务格式的Excel文件
2. **工作表名称**：默认读取"下周工作计划"工作表，可通过`sheet_name`参数修改
3. **临时文件**：如果不指定`merged_excel_path`，工具会使用临时文件，处理完成后自动清理
4. **目录权限**：确保对输出目录有写入权限
5. **文件编码**：支持UTF-8编码的文件路径

## 错误处理

- 如果输入文件不存在，会返回具体的错误信息
- 如果合并失败，会返回详细的错误原因
- 如果图片生成失败，但Excel合并成功，会返回合并文件的位置

## 与原有工具的区别

| 功能 | 原有工具 | 新工具 |
|------|----------|--------|
| Excel合并 | `merge_excel_files` | ✅ 集成 |
| 工时处理 | `process_worktime` | ✅ 集成 |
| 操作步骤 | 需要两步操作 | 一步完成 |
| 临时文件 | 需要手动管理 | 自动管理 |
| 错误处理 | 分别处理 | 统一处理 |

这个新工具大大简化了工时报表生成的流程，提高了工作效率。

