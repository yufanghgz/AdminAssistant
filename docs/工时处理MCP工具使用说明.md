# 工时处理 MCP 工具使用说明

## 功能概述

新的 `process_worktime` MCP 工具专门用于处理项目任务格式的 Excel 文件，生成工时展示图片。该工具可以可视化显示部门工作状态与项目分配情况。

## 工具参数

### 必需参数
- `excel_file_path`: 包含项目任务数据的Excel文件路径
- `output_path`: 输出图片文件路径

### 可选参数
- `staff_file_path`: 人员名单Excel文件路径（可选）
- `sheet_name`: 要读取的工作表名称，默认为 "下周工作计划"
- `title`: 图表标题（可选）

## 使用方式

### 基本用法
```json
{
  "excel_file_path": "/path/to/worktime_data.xlsx",
  "output_path": "/path/to/worktime_chart.png"
}
```

### 完整参数用法
```json
{
  "excel_file_path": "/path/to/worktime_data.xlsx",
  "output_path": "/path/to/worktime_chart.png",
  "staff_file_path": "/path/to/staff_list.xlsx",
  "sheet_name": "下周工作计划",
  "title": "2025年9月第1周部门工作状态与项目分配可视化"
}
```

## 功能特性

1. **智能人员分组**: 按项目自动分组人员，便于查看项目分配情况
2. **日期范围自动计算**: 根据任务开始和结束日期自动确定展示时间范围
3. **可视化展示**: 生成直观的工时展示图片，显示每个人的工作安排
4. **项目信息显示**: 在图表中显示具体的项目名称
5. **状态区分**: 清晰区分已安排工作和未安排工作
6. **中文字体支持**: 支持中文显示，确保图表可读性

## 输入文件要求

### Excel文件格式
Excel文件应包含以下字段：
- **任务名称**: 具体的工作任务描述
- **指派人名称**: 负责执行任务的人员
- **计划开始日期**: 任务的计划开始时间
- **计划结束日期**: 任务的计划结束时间
- **项目名称**: 任务所属的项目名称
- **计划工时数(h)**: 预计的工作时间（可选）

### 人员名单文件（可选）
如果提供人员名单文件，工具会使用该文件的人员列表。文件应包含：
- 第一列：人员姓名
- 支持 .xlsx 和 .xls 格式

## 输出图片特性

### 图表布局
- **横轴**: 日期（格式：MM-DD）
- **纵轴**: 人员姓名（按项目分组）
- **颜色编码**:
  - 浅绿色：已安排工作
  - 白色：未安排工作

### 信息显示
- 每个单元格显示项目名称
- 未安排的工作显示"未安排"标识
- 包含图例说明
- 显示总人数统计

## 典型应用场景

1. **项目工时管理**: 查看项目人员分配情况
2. **工作负载分析**: 分析人员工作饱和度
3. **项目进度跟踪**: 可视化项目时间安排
4. **资源规划**: 优化人员资源配置
5. **周/月度计划展示**: 生成工作计划展示图

## 注意事项

1. **文件路径**: 确保Excel文件路径正确且文件存在
2. **数据质量**: 确保日期格式正确，人员姓名一致
3. **输出目录**: 确保输出目录存在或有写入权限
4. **图片格式**: 输出为PNG格式，支持高分辨率显示
5. **字体支持**: 需要系统中文字体支持，确保中文正常显示

## 示例输出

处理完成后会返回类似以下信息：
```
工时处理完成，展示图片已保存到: /path/to/worktime_chart.png
```

## 技术特点

- **高分辨率输出**: 300 DPI，适合打印和展示
- **自适应布局**: 根据人员数量和日期范围自动调整图表大小
- **数据验证**: 自动处理缺失数据和异常值
- **错误处理**: 完善的错误处理和日志记录
- **性能优化**: 高效的数据处理和图表生成

## 与Excel合并工具的配合使用

建议工作流程：
1. 使用 `merge_excel_files` 工具合并多个项目Excel文件
2. 使用 `process_worktime` 工具生成工时展示图片
3. 获得完整的项目工时管理和可视化解决方案
