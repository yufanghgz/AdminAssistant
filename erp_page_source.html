<html lang="zh-cn" style="font-size: 80px;"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta http-equiv="pragma" content="no-cache">
    <title>Sign In</title>
    <link rel="Shortcut Icon" href="/csom/extension/img/app-bf.ico" type="image/x-icon">
    <link rel="stylesheet" href="../../../libs/layui/css/layui.css">
    <link rel="stylesheet" href="css/login.css">
    <link rel="stylesheet" href="css/dialog.css">
    <script src="../../../libs/jQuery/jQuery-min.js"></script>
    <script>
      // updateInfo配置
      document.write('<script src="../../../extension/js/updateInfo.js?time=' + new Date().getTime() +'" charset="UTF-8"><\/script>');
    </script><script src="../../../extension/js/updateInfo.js?time=1756031387515" charset="UTF-8"></script>
    <script>
      // 系统维护时展示系统维护页面
      if (window.g.maintainInfo.isMaintain) {
        // 判断是否运维人员  非运维人员再跳转
        if (isDevOps === undefined) {
            var isDevOps = false
            $.ajax({
                type: 'get',
                async: false,
                url: "/cosmo-app/config/v3.0/whitelist/check",
                success: function (result) {
                    isDevOps = result.data
                }
            })
            if (!isDevOps) {
              window.location.href = '../../../maintain.html';
            }
        } else {
            if (!isDevOps) {
              window.location.href = '../../../maintain.html';
            }
        }
      }
    </script>
<link id="layuicss-laydate" rel="stylesheet" href="http://erp.ex.cosmosource.com:24080/csom/libs/layui/css/modules/laydate/default/laydate.css?v=5.0.9" media="all"><link id="layuicss-layer" rel="stylesheet" href="http://erp.ex.cosmosource.com:24080/csom/libs/layui/css/modules/layer/default/layer.css?v=3.1.1" media="all"><link id="layuicss-skincodecss" rel="stylesheet" href="http://erp.ex.cosmosource.com:24080/csom/libs/layui/css/modules/code.css" media="all"></head>
<body style="overflow-y: hidden;">
    <div id="wrap" class="loginWrap" style="height: 100%; position: absolute;">
        <!-- logo -->
        <div class="imgLogo">
            <img alt="logo" src="img/ydy.png">
        </div>
        <div class="content">
            <!-- 登录 -->
            <div class="loginRight" style="margin-top: -284px;">
                <div class="layui-tab layui-tab-brief">
                    <div class="signName" id="htmlTitle">欢迎登录</div>
                    <div class="layui-tab-content">
                        <div class="layui-tab-item userPwd-box layui-show">
                            <form id="loginForm">
                                <div class="user">
                                    <div class="layui-input-block">
                                        <div class="form-title"><span>账号</span></div>
                                        <img class="label-icon" src="img/name.png" alt="">
                                        <input type="text" id="userName" name="username" placeholder="请输入您的账号" autocomplete="off" class="formInput" onfocus="focusName()">
                                        <img class="shanchu" id="nameImg" src="img/shanchu-2.png" onclick="clearName()">
                                    </div>
                                </div>
                                <div class="pass">
                                    <div class="layui-input-block">
                                        <div class="form-title"><span>密码</span></div>
                                        <img class="label-icon" src="img/password.png" alt="">
                                        <span class="password-eye" data-action="password-eye"><i class="eye-visible"></i><i class="eye-hidden"></i></span>
                                        <input type="password" id="passWord" name="password" placeholder="请输入您的密码" autocomplete="off" class="formInput" onfocus="focusPass()">
                                        <img class="shanchu" id="passImg" src="img/shanchu-2.png" onclick="clearPass()">
                                    </div>
                                </div>
                                <div class="verification" id="validateCode" style="display: block;">
                                    <div class="layui-input-block">
                                        <div class="form-title"><span>验证码</span></div>
                                        <div class="codeWrap">
                                            <img class="label-icon" src="img/yzm.png" alt="">
                                            <input type="text" id="verify" name="validateCode" placeholder="请输入验证码" autocomplete="off" class="formCode" onfocus="focusCode()">
                                            <span class="cap"><img id="code_img" src="data:image/png;base64,/9j/4AAQSkZJRgABAgAAAQABAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAxNDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjL/wAARCAAmAHgDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD3Kiisq+1iSHVodKsrZbm9eIzuJJfLSOIHG4tgkktgAAH3xTSb2A1aKyLTV7x9bOl3um/Z38lp1mSbzI3UFBhTtBzljkEDGB13Vr0NNbgZ2qa3Z6S9tDOzyXd2zJa2sK7pZ2AyQo6AAdWYhVyMkCqKeK7ddXsNJvdPv7HUL9nEEM6IQyohdn3ozJgYxjduyRlcEGsrSJpdS+K/iN55XC6RaW9pbRKx2bZh5rsQf4sooyMcAZBxmumvNJtb7UNOvpU/0jT5XkgcAZ+aNkZScZ2kNnAxyq+lSVoi9RWbLFJpkz3NtG0lq7F7i3QZKk8mSMDqe7IOvUfNkO661N1NoljbNeG7UtFMrYgUAA5eQA4BB4wDk/nTehnzpbmhRWRFrE8WrwabqVpHby3SM1s8MxlSQryynKqVIGD0wfXPFa9JO4RkpbFTUtStNH0+W/v5vJtosb32lsZIA4AJ6kVnzeJYrN7dNQ06+s3up47eASKjiR2bGNyMwXGc/MRkA4zg1meLre61i+sLHT4lmn0uWLVpEZ9gcqxEcWSOC+JSG5AMWCAGBq3pniLSvEax2F2jWmpI0csmnXO6OVHU+YuM43AbQ3HbGQM4qW9bDeh0dFFMkljhUNK6opYKCxwMkgAfUkgD3NWMfRRRQAVg6ppul6zrP2aR5rbVLe3WWK5t5fLlWNmYHaR1HykHIIG/jrW9VO60nTb+US3mn2txIF2h5oVcgemSOnJqouzuBjaHe6tD4hvNF1G7j1FYoVnF3HGIzGTgeW6rwCeWHOcc8546WoLWytLCIxWdtDbxltxSGMICfXA78Cp6JNN3QI4gf8U78VLm4n/dad4htoUFxL903kWVWJSOF3R5IDfeIwD2rO8W6Zot38WfCME1jYTTXK3j3kbxIzSqIQIzICMsAVO0n+6cdK9BvLK11C1e1vbaG5t3xvimjDo2DkZB4PIB/CoNO0bStI8z+zNNs7LzceZ9mgWPfjOM7QM4yfzNRYrm6l6uK16eWw8SQ2q3FxZ6Q8L3t2IpAnmFWy/lnG4EY3uFbJUsQNxO7tagurK1vohFeW0NxGG3BJow4B9cHvyaGrmFWDnGyZx+qf2PpXjTRHg+zxNAl1JeMnzSACHcGkxlicZOTknnrXb1htZWujKivbQtpEcvnIDGCLKTJO8eiZJOeqZP8H3NylGNriowcXLzf6W/Q486udEt7PWtSjMLazfpHMJl2tbQFH8lDuI2bcKzgkgM8pHWk+If2f8Asqz8ryv7c+1xf2VnG/zd65xnjGOu75fu55xXXPFHI0bPGrNG25CwyVOCMj0OCR9CaqWejaXp0xmsdNs7aUrtLwQKhI64yB04H5UOLasayTdy9Ve+tI7+yltZSyrIuA6HDIeoZT2YHBB7EA1YoqtwavoylpN3Je6dHLMFE6s8U2wfL5iMUfbnnbuU4zzjGaKgj/0LxDMh+WHUEEiehmQYfJPcoI8Ado3OBgklKOwoPSzNSiiimUFFFFABRRRQAUUUUAFUrOzksZjDCVNhtzHGTzCf7q+qdcD+HGBlSApRQTLuXaKKKCgooooAr3dpHeLEHLK0UqSo6HDKVOeD2BGVPqrEd6KKKBWP/9k="></span>
                                        </div>
                                    </div>
                                </div>
                                <input type="hidden" name="_csrf" id="csrf" value="">
                                <span id="spanCode" class="prompt"></span>
                            </form>
                            <button class="btn" onclick="signIn()">登 录</button>
                        </div>
                        <div class="layui-tab-item mobile-box">
                            <form id="loginForm">
                                <div class="user">
                                    <div class="layui-input-block">
                                        <div class="form-title"><span>手机号</span></div>
                                        <img class="label-icon" src="img/mobile-icon.png" alt="">
                                        <input type="text" id="phone" name="phone" placeholder="请输入手机号" autocomplete="off" class="formInput" onfocus="focusName()">
                                        <img class="shanchu" id="nameImg" src="img/shanchu-2.png" onclick="clearName()">
                                    </div>
                                </div>
                                <div class="verification" id="validateCode2" style="display: block;">
                                    <div class="layui-input-block">
                                        <div class="form-title"><span>验证码</span></div>
                                        <div class="codeWrap">
                                            <img class="label-icon" src="img/yzm.png" alt="">
                                            <input type="text" id="codeVerify" name="validateCode" placeholder="请输入验证码" autocomplete="off" class="formCode" onfocus="focusCode()">
                                            <span class="cap"><img id="code_img2"></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="verification" style="margin: 14px 0 2px;">
                                    <div class="layui-input-block">
                                        <div class="form-title"><span>短信验证码</span></div>
                                        <div class="codeWrap">
                                            <img class="label-icon" src="img/yzm.png" alt="">
                                            <input type="text" id="phoneVerify" name="validateCode" placeholder="请输入验证码" autocomplete="off" class="formInput">
                                            <a class="getMessage" onclick="getMessage()">获取短信验证码</a>
                                        </div>
                                    </div>
                                </div>
                                <input type="hidden" name="_csrf" id="csrf" value="">
                                <span id="spanCode2" class="prompt"></span>
                            </form>
                            <button class="btn" onclick="signIn2()">登 录</button>
                        </div>
                    </div>
                    <div class="link">
                        <a data-action="change-login"><img src="img/mobile.png">手机号登录</a>
                        <a id="forget_password">忘记密码</a>
                    </div>
                </div>
            </div>
            <div class="tip-dialog">
                <div class="dialog-con">
                    <!-- // 提示语 -->
                    <div class="dialog-text">
                        HI，您当前的浏览器版本过低，可能存在安全风险，建议立即升级浏览器。
                    </div>

                    <!-- // 两个按钮 -->
                    <div class="dialog-btns">
                        <div id="dialogBtn1">下载火狐</div>
                        <div class="acbtn" id="dialogBtn2">下载chrome</div>
                    </div>

                    <!-- // 关闭按钮 -->
                    <!-- <div class="close-dialog"></div> -->
                </div>
            </div>
        </div>
        <!-- 页脚区域 -->
        <footer class="company-name" id="companyBot">系统运维：ERP维护员：王司琪    ERP-用户管理员：黄庆伟    ERP-IT运维员：张基地      公司运维员：晋亚楠</footer>
    </div>
  <!--   嵌入修改密码页-->
  <iframe class="updatePwd" id="myiframe" frameborder="0" src=""></iframe>

<script>
  $.ajax({
    url: "../../../ver.version",
    headers: {
      // 配置
      'Cache-Control': 'no-cache'
    },
    // 请求为同步
    async: false,
    success: function (data) {
      data = data.replace(/\n/g, "").replace(/\r/g, "").replace(/\s/g, "")
      //存取前端的版本号
      window.leadingVersion = JSON.parse(data).product_version_number;
    }
  })
  // updateInfo配置
  document.write('<script src="../../../extension/js/updateInfo.js?time=' + new Date().getTime() +
    '" charset="UTF-8"><\/script>');
  // 动态适配当前的分辨率
  document.write('<script src="../../../js/resize.js?version=' + window.leadingVersion + '" charset="UTF-8"><\/script>');
  document.write('<script src="../js/badbrowser.js?version=' + window.leadingVersion + '" charset="UTF-8"><\/script>');

</script><script src="../../../extension/js/updateInfo.js?time=1756031387784" charset="UTF-8"></script><script src="../../../js/resize.js?version=8.3.5.5-RC.170" charset="UTF-8"></script><script src="../js/badbrowser.js?version=8.3.5.5-RC.170" charset="UTF-8"></script>
<script src="../../../libs/crypto-js.js"></script>
<script src="../../../libs/sm2.js"></script>
<script src="../../../libs/layui/layui.all.js"></script>
<script>
  $('link[rel*=Icon]').attr('href', window.g.icon)
  var browser = new badbrowser({
    path: null,
    template: null,
    supported: {
      // IE
      msie: '11',
      msedge: '11',
      // 火狐
      firefox: '33',
      // 谷歌
      chrome: '55',
      // 欧鹏
      opera: '28',
      // 苹果
      safari: '8'
    }
  })
  // 获取项目根目录
  function getRootPath (){
    //获取主机地址之后的目录，如： /ems/Pages/Basic/Person.jsp
    var pathName = window.document.location.pathname;
    //获取带"/"的项目名，如：/ems
    var projectName = pathName.split('/')[1]
    return projectName;
  };
  var rootPath = getRootPath ()
  // 打开弹窗
  function showDialog(){
    $('.dialog-con').addClass('fadeIn')
    $('.tip-dialog').show()
    $('.close-dialog').click(function(){
      xDialog()
    })

    $('#dialogBtn1').hover(function(){
      $('#dialogBtn2').removeClass('acbtn')
      $(this).addClass('acbtn')
    }, function(){
      $('.dialog-btns div').removeClass('acbtn')
      $('#dialogBtn2').addClass('acbtn')
    })

    $('#dialogBtn2').hover(function(){
      $('#dialogBtn1').removeClass('acbtn')
      $(this).addClass('acbtn')
    }, function(){
      $('.dialog-btns div').removeClass('acbtn')
      $('#dialogBtn2').addClass('acbtn')
    })
  }
  // 发起请求
  function getBrowserVersionLowDialog(){
    $.ajax({
      url: '/cac/dialog/browserVersionLow',
      type: 'GET',
      success: function(data){
        renderContent(data)
      }
    })
  }

  // 渲染弹窗里的 内容
  function renderContent(data){
    var actions = data["actions"];
    $('#dialogBtn1').html(actions[0]["action-name"]);
    $('#dialogBtn1').click(function(){
      window.open(actions[0]["action-url"]);
    })

    $('#dialogBtn2').html(actions[1]["action-name"]);
    $('#dialogBtn2').click(function(){
      window.open(actions[1]["action-url"]);
    })

    $('.dialog-text').html(data['content']);
    showDialog()
  }

  // 验证码是否启用
  var isValidateCodeEnable = true;
  var baseMyAppUrl = window.g.commonUrl;
  // 是否启用明文登录
  var isEncryption = false
  // 是否启用明文登录
  request({
    url: baseMyAppUrl+"/login/v3.0/encrypt",
    type:"get",
    success: function (result) {
      if(result == true){
        isEncryption = true
      }
    }
  });
  // 是否需要验证码
  request({
    url: baseMyAppUrl+"/v3.0/getCodeSwitch/"+ window.g.pathName,
    type:"get",
    success: function (result) {
      if (!result || result === "false") {
        document.getElementById("validateCode").style.display = "none";
        $('.loginRight').css({marginTop:'-235px'})
        isValidateCodeEnable = false;
        // 点击图片刷新
        document.getElementById('code_img').removeAttribute("onclick");
      } else {
        document.getElementById("validateCode").style.display = "block";
        document.getElementById("validateCode2").style.display = "block";
        $('.loginRight').css({marginTop:'-284px'})
        isValidateCodeEnable = true;
        refreshImgCode();
        // 点击图片刷新
        document.getElementById('code_img').onclick = function () {
          refreshImgCode();
        }
        // 点击图片刷新
        document.getElementById('code_img2').onclick = function () {
          refreshImgCode2();
        }

      }
    }
  });
  // 刷新验证码
  function refreshImgCode(text) {
    $("#spanCode").text(text||"");
    request({
      url: baseMyAppUrl+"/v3.0/getVerifyCode" + "?width=" + parseInt($("#code_img").width()) + "&height=" + parseInt($("#code_img").height()) + "&route=" + window.g.pathName,
      success: function (base64Img) {
        if (base64Img) {
          $("#code_img").attr("src", "data:image/png;base64," + base64Img);
        }
      }
    });
  }
  // 刷新验证码
  function refreshImgCode2(text) {
    $("#spanCode2").text(text||"");
    request({
      url: baseMyAppUrl+"/v3.0/getVerifyCode" + "?width=" + parseInt($("#code_img").width()) + "&height=" + parseInt($("#code_img").height()) + "&route=" + window.g.pathName,
      success: function (base64Img) {
        if (base64Img) {
          $("#code_img2").attr("src", "data:image/png;base64," + base64Img);
        }
      }
    });
  }


  window.onload = function(){
    document.onkeydown = function (e) {
      // 兼容FF和IE和Opera
      var theEvent = window.event || e;
      var code = theEvent.keyCode || theEvent.which || theEvent.charCode;
      if (code === 13) {
        signIn();
      }
    }

    // 主函数
    function __main__(){
      try{
        if(!browser.check()){
          getBrowserVersionLowDialog()
          // showDialog()
        } else {
          // 监听页面的高度
          var result = window.matchMedia('(max-height:680px)');
          result.addListener(mediaMatches)
          // 自适应的方法
          mediaMatches(result);
        }
      }catch(e){
        getBrowserVersionLowDialog()
      }
    }
    __main__();
    //  项目标题（显示在浏览器页签上）
    document.getElementsByTagName('title')[0].innerText = window.g.config.title
    //  项目ico（显示在浏览器页签上）
    $('link[rel*=Icon]').attr('href', '/'+ window.g.pathName + window.g.icon)
    // 登录logo和标题
    // $('.imgLogo img').attr('src','/'+ window.g.pathName + window.g.logoUrl)
    // 登录框里面的欢迎语
    document.getElementById("htmlTitle").innerHTML = window.g.config.htmlTitle
    // 底部文字
    document.getElementById("companyBot").innerHTML = window.g.config.companyBot

    // 错误信息
    var errormsg = getQueryString("errormsg");
    if (errormsg) {
      $("#spanCode").text(errormsg);
    }

    // // 表单中添加参数
    // $("#csrf").val(getCookie("XSRF-TOKEN"));
    // 密码可见不可见
    $(document).on('click', '[data-action=password-eye]', function (event) {
      if($(this).hasClass('show')){
        $(this).removeClass('show')
        $(this).next('input').attr('type','password')
      }else{
        $(this).addClass('show')
        $(this).next('input').attr('type','text')
      }
    })
    // 手机号登录，用户名登录
    $(document).on('click', '[data-action=change-login]', function (event) {
      if($(this).hasClass('show')){
        $("#spanCode").text("");
        refreshImgCode();
        $('.mobile-box').removeClass('layui-show').siblings().addClass('layui-show')
        $(this).removeClass('show')
        $(this).html('<img src="img/mobile.png"/>手机号登录')
      }else{
        $("#spanCode2").text("");
        $('.mobile-box').addClass('layui-show').siblings().removeClass('layui-show')
        $(this).addClass('show')
        $(this).html('<img src="img/userLogin.png"/>用户名登录')
        if($('#validateCode2').is(':visible')){
          refreshImgCode2();
        }
      }
    })
  }
    function getQueryString(name) {
        var reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)', 'i');
        var r = window.location.search.substr(1).match(reg);
        if (r != null) {
            return unescape(decodeURI(r[2]));
        }
        return null;
    }

    function request(param) {
        param.type = param.type || 'post';
        $.ajax(param)
    }
  var timer = null
  var sum = 60
  // 手机号-键入执行
  $(document).on('input propertychange', '#phone', function () {
    $("#spanCode2").text("");
  })
  // 获取短信验证码
  function getMessage(){
    $("#spanCode2").text("");
    var phone = $('#phone').val()
    if(!phone){
      $("#spanCode2").text("手机号不能为空");
      return
    }
    var reg = /^1[3-9]\d{9}$/;
    if(!reg.test(phone)){
      $("#spanCode2").text("输入手机号有误");
      return
    }
    var codeVerify = $('#codeVerify').val()
    if($('#validateCode2').is(':visible') && !codeVerify){
      $("#spanCode2").text("验证码不能为空");
      return
    }
    if($('.getMessage').hasClass('grey')){
      // layer.msg(sum+'内不能获取两次验证码，请稍后重试');
      return
    }
    // 给手机发送验证码
    $.ajax({
      url: '/cosmo-app/verificationCode?sendTarget='+phone+'&expireTime=&route='+window.g.pathName+'&imgVerifyCode='+codeVerify,
      type: 'POST',
      success: function(res){
        if(res.status == 200){
          sum = res.data.expireTime;
          $('.getMessage').text('请在'+sum+'s后再获取').addClass('grey')
          timer = setInterval(function() {
            if (sum <= 1) {
              clearInterval(timer)
              $('.getMessage').text('获取短信验证码').removeClass('grey')
              return
            }
            sum = sum - 1
            $('.getMessage').text('请在'+sum+'s后再获取')
          }, 1000)
        }else{
          $("#spanCode2").text(res.msg);
          if($('#validateCode2').is(':visible')){
            refreshImgCode2();
          }
        }
      }
    })
  }
  // 点击登录的事件
  function signIn2(){
    $("#spanCode2").text("");
    var phone = $('#phone').val()//手机号
    var phoneVerify = $("#phoneVerify").val();//验证码
    var publichex = '042bbcab1deb97d4f98c8926d5d7358bb4b8f127978f13bab159880f8daaffb68abb32c5c9b106b621e3ef47174953295a12602bf1b1d3b03cae8f1713fd53a84f';
    request({
      url: window.g.commonUrl + "/login",
      data: {
        "a": isEncryption?phone:sm2Encrypt(phone,publichex,0),
        "b": isEncryption?phoneVerify:sm2Encrypt(phoneVerify,publichex,0),
        "route": window.g.pathName,
        redirect_url:location.href,//当前登录页url
        type:'phone'
      },
        success: function (resp) {
          localStorage.setItem("access_token",resp.data.certification.token)
          document.cookie = "cosmosource_token=" + resp.data.certification.token + ";path=/";
          window.location.href='/cag/fileAccess?access_token='+resp.data.certification.token + '&path='+window.location.origin + '/' +
          window.location.pathname.split('/')[1] + '&objType='+ window.location.pathname.split('/')[1]
        },
      error: function (error) {
        $("#spanCode2").text(error.responseJSON.msg);
        if($('#validateCode2').is(':visible')){
          refreshImgCode2(error.responseJSON.msg);
        }
      }
    });
  }
  // 点击登录的事件
  function signIn(){
      if(!document.getElementById("userName").value){
        $("#spanCode").text("账户不能为空");
        return;
      }else if(!document.getElementById("passWord").value){
        $("#spanCode").text("密码不能为空");
        return;
      } else {
        // 清除小铃铛连接失败信息
        localStorage.removeItem('socketConnect');
        document.cookie = 'cmcConnect=;path=/;expires=date()+1';
        login();
      }
    }

  var items={};
  // 登陆
  function login(){
    var username = document.getElementById("userName").value;//用户名
    var password = document.getElementById("passWord").value;//密码
    var requestCaptcha = document.getElementById("verify").value;//验证码
    // var validateCode = document.getElementById("verify").value;
    // var queryParam = "username=" + username + "&password=" + password + "&validateCode=" + validateCode
    var publichex = '042bbcab1deb97d4f98c8926d5d7358bb4b8f127978f13bab159880f8daaffb68abb32c5c9b106b621e3ef47174953295a12602bf1b1d3b03cae8f1713fd53a84f';

    var base = new Base64();
    var item=document.getElementById("userName").value + "&pw="+ document.getElementById("passWord").value;
    localStorage.setItem("items",base.encode(base.encode(item)));
    request({
      url: window.g.commonUrl + "/login",
      data: {
        "a": isEncryption?username:sm2Encrypt(username,publichex,0),
        "b": isEncryption?password:sm2Encrypt(password,publichex,0),
        "requestCaptcha": requestCaptcha,
        "route": window.g.pathName,
        redirect_url:location.href,//当前登录页url
      },
        success: function (resp) {
          // token
          // 存储当前操作用户名
          localStorage.setItem("oper_access_token", resp.data.certification.token);
          localStorage.setItem("operLoginUid", resp.data.username)
          localStorage.setItem("operUserId", resp.data.userId)
          localStorage.setItem("access_token",resp.data.certification.token)
          document.cookie = "cosmosource_token=" + resp.data.certification.token + ";path=/";
          window.location.href='/cag/fileAccess?access_token='+resp.data.certification.token + '&path='+window.location.origin + '/' +
          window.location.pathname.split('/')[1] + '&objType='+ window.location.pathname.split('/')[1]
          // window.location.href = "../../index.html"
        },
      error: function (error) {
        if(error?.responseJSON?.data?.isChangePwd){
          items = error.responseJSON.data;
          items.alertContent=error.responseJSON.msg;
          // 显示修改密码页面
          $('#wrap').hide()
          $('#myiframe').attr('src','/common_setting_comsvr/change/userInfo.html')
          return
        }
        refreshImgCode(error.responseJSON.msg)
      }
    });
  }
  // 账户的聚焦事件
  function focusName(){
    document.getElementById("nameImg").style.display='block'
    document.getElementById("passImg").style.display='none'
  }
  // 密码的聚焦事件
  function focusPass(){
    document.getElementById("nameImg").style.display='none'
    document.getElementById("passImg").style.display='block'
  }
  // 验证码的聚焦事件
  function focusCode(){
    document.getElementById("nameImg").style.display='none'
    document.getElementById("passImg").style.display='none'
  }
  // 清空input的点击事件
  // 账户
  function clearName(){
    document.getElementById("userName").value=""
  }
  // 密码
  function clearPass(){
    document.getElementById("passWord").value=""
  }

  // 监听页面的高度
  function mediaMatches(result){
  if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {

    } else {
      if(result.matches) {
        document.getElementById('wrap').style.minHeight = "100vh";
        document.getElementById('wrap').style.position= "static";
        document.body.style.overflowY="auto"
      }else{
        document.getElementById('wrap').style.height = "100%";
        document.getElementById('wrap').style.position= "absolute";
        document.body.style.overflowY="hidden"
      }
    }
}

 function registeron(){
 	window.location.href = './register/register.html'
 	}


  // 子页面给父页面传值
  function getChildValue(val) {
    var isClearPwd = val
    if(isClearPwd){
      $('.loginWrap').css('display','block')
      document.getElementById("passWord").value = ''
    }
  }
  getChildValue()
  //父页面传值给子页面
  function toChildValue() {
    var obj={
    }
    // 账号
    obj.userName = document.getElementById("userName").value;
    // 密码
    obj.p_w = document.getElementById("passWord").value;
    // 用户过期
    var alertContent = items["alertContent"]
    if(alertContent){
      obj.alertContent = alertContent
    }
    // 强密码开关
    var pwdRuleStrengthenEnabled = items["pwdRuleStrengthenEnabled"]
    if(pwdRuleStrengthenEnabled){
      obj.pwdRuleStrengthenEnabled = pwdRuleStrengthenEnabled
    }
    // 下次登录是否修改密码
    var changeLoginPwdFlag = items["changeLoginPwdFlag"]
    if(changeLoginPwdFlag){
      obj.changeLoginPwdFlag = changeLoginPwdFlag
    }
    // 修改周期
    var pwdChangeInterval = items["pwdChangeInterval"]
    if(pwdChangeInterval){
      obj.pwdChangeInterval = pwdChangeInterval
    }
    var userId = items["userId"]
    if(userId){
      obj.userId = userId
    }
    return obj;
  }

  // 忘记密码
  $('#forget_password').click(function (){
    var that = this;
    layer.tips('请联系人事部-黄庆伟', that, {
      tips: [3, '#020B1999'],
      skin: 'forgetTips',
      shade: [0.01, '#fff'],
      time: 0,
      shadeClose: true,
      closeBtn: 0,
      isOutAnim: false,
      success: function (layero, index){
        var oldLeft = layero.css('left');
        oldLeft = oldLeft.substring(0, oldLeft.indexOf('px'))
        var tipWidth = $('.forgetTips').width();
        var textWidth = $(that).width()
        layero.css("left", (oldLeft - tipWidth / 2 + textWidth / 2) + 'px')
      }
    });
  });

</script>

</body></html>